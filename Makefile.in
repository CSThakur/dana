prefix		:= @prefix@
abs_top_srcdir	:= @abs_top_srcdir@
XLEN            := @XLEN@
ROCC            := xfiles-dana

test_smoke_dir  := $(abs_top_srcdir)/smoke
test_nets_dir   := $(abs_top_srcdir)/nets

.PHONY: all smoke nets clean

all: install

install: smoke nets | all_tests
	for a in $^; do for b in `ls $$a`; do ln -sf ../$$a/$$b all_tests/; done ; done

all_tests:
	mkdir $@

smoke:
	mkdir -p $@
	$(MAKE) -C $@ -f $(test_smoke_dir)/Makefile abs_top_srcdir=$(abs_top_srcdir) src_dir=$(test_smoke_dir) XLEN=$(XLEN) ROCC=$(ROCC)

nets:
	mkdir -p $@
	$(MAKE) -C $@ -f $(test_nets_dir)/Makefile abs_top_srcdir=$(abs_top_srcdir) src_dir=$(test_nets_dir) XLEN=$(XLEN) ROCC=$(ROCC)

clean:
	$(MAKE) -C smoke -f $(test_smoke_dir)/Makefile abs_top_srcdir=$(abs_top_srcdir) src_dir=$(test_smoke_dir) ROCC=$(ROCC) clean
	$(MAKE) -C nets -f $(test_nets_dir)/Makefile abs_top_srcdir=$(abs_top_srcdir) src_dir=$(test_nets_dir) ROCC=$(ROCC) clean
