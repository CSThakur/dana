#-*- mode: makefile-*-

DIR_TOP  = ../../..

PES ?= 1
EPB ?= 4
CONFIG ?= XFilesDanaCppPe${PES}Epb${EPB}Config
BIN_SUFFIX = $(shell echo "$(EPB) 4*p" | dc)bin

EMULATOR ?= ../$(DIR_TOP)/emulator/emulator-Top-$(CONFIG)
C_FLAGS  ?= -Wall \
	-Werror \
	-O3 \
	-static \
	-march=RV64IMAFDXcustom \
	-I$(DIR_TOP)/usr/include \
	-I$(DIR_TOP)/build/nets \
	-I$(DIR_TOP)
L_FLAGS  ?= -L$(DIR_TOP)/usr/lib-rv-newlib \
	-lxfiles \
	-lfixedfann \
	-lm
MAX_CYCLES ?= 100000000
DECIMAL_POINT_OFFSET=7
TEST_NAME ?= `readlink -f . | sed 's/^.\+\///'`

# Architectural parameters
DECIMAL_POINT_OFFSET=7
DECIMAL_POINT_BITS=3
MAX_DECIMAL_POINT=`echo "2 $(DECIMAL_POINT_BITS)^1-$(DECIMAL_POINT_OFFSET)+p"|dc`

PHONY += all default clean

default: all

%.rv: %.c $(DIR_TOP)/build/newlib/libxfiles.a $(DIR_TOP)/build/fann-rv-newlib/libfann.a
	@ $(RV_CC) $(C_FLAGS) $< -o $@ $(L_FLAGS)

# Common utilities
TOOL_COMPARE = ../../common/compare.sh
TOOL_HIT_MAX_EPOCHS = ../../common/hit-max-epochs.sh

JUNK = *.emulator *.rv

clean:
	rm -f $(JUNK)

include $(DIR_TOP)/Makefile
