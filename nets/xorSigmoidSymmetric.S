# See LICENSE.ibm for license details.

#*****************************************************************************
# id.S
#-----------------------------------------------------------------------------
#
# Check that the ID matches what we expect
#

#include "riscv_test.h"
#include "include/test_macros.h"
#include "include/xfiles-dana.h"
#include "rocc-software/src/xcustom.h"
#include "rocc-software/src/riscv_test_rocc.h"
#include "libs/src/xfiles-supervisor.S"
#include "libs/src/xfiles-user.S"

#define CUSTOM_X 0

#define STACK_TOP (_end + 4096)

// RVTEST_CODE_BEGIN includes the EXTRA_INIT macro before its final
// `mret` and the resulting drop to user mode. We use this to setup
// the ASID and ANTP for a single transaction test.
#undef EXTRA_INIT
#define EXTRA_INIT                              \
  SET_ASID(1);                                  \
  SET_ANTP(antp_dana, antp_os); \
  la sp, _end + 1024;

RVTEST_WITH_ROCC

start:

RVTEST_CODE_BEGIN
  TEST_CASE( 2, a0, 0, NEW_WRITE_REQUEST(0, 0, 0) );
  // I am dangerously _not_ saving the TID here, but we know it's '0'
  TEST_CASE( 3, a0, 0, WRITE_DATA(0, data_in, 2) );
  TEST_CASE( 4, a0, 0, READ_DATA_SPINLOCK(0, data_out, 1) );

  TEST_PASSFAIL

RVTEST_CODE_END

  .data
RVTEST_DATA_BEGIN

  TEST_DATA

data_in:
  .word 0x0
  .word 0x16384
data_out:
  .word 0x0
// ./tools/bin/generate-ant -a 1,build/nets/xorSigmoidSymmetric-fixed.16bin | util/hdl-tools/scripts/bits-to-asm
// [INFO] asid: 1
// [INFO] file: build/nets/xorSigmoidSymmetric-fixed.16bin
// [INFO] max asid: 1
// [INFO] 0x0x2631c20 <- Table Head
// [INFO]   |-> 0x0x2631c20: size:                     0x2
// [INFO]       0x0x2631c28: * entry_p:                0x0x20
// [INFO]       0x0x2631c30: * entry_v:                0x0x2631c40
// [INFO]         |-> [0] 0x0x2631c40: num_configs:    0xa
// [INFO]         |       0x0x2631c44: num_valid:      0x0
// [INFO]         |       0x0x2631c48: asid_nnid_p:    0x0x70
// [INFO]         |       0x0x2631c50: asid_nnid_v:    0x0x2631c90
// [INFO]         |       0x0x2631c58: transaction_io: 0x0x2631e30
// [INFO]         |         |-> 0x0x2631e30: header:   0x0
// [INFO]         |         |   0x0x2631e38: * input:  0x0x2631e50
// [INFO]         |         |   0x0x2631e40: * output: 0x0x2631e80
// [INFO]         |-> [1] 0x0x2631c60: num_configs:    0xa
// [INFO]         |       0x0x2631c64: num_valid:      0x1
// [INFO]         |       0x0x2631c68: asid_nnid_p:    0x0x3b0
// [INFO]         |       0x0x2631c70: asid_nnid_v:    0x0x2631fd0
// [INFO]         |         |-> [0] 0x0x2631fd0: size:             0x22
// [INFO]         |         |       0x0x2631fd8: elements_per_block: 0d4
// [INFO]         |         |       0x0x2631fe0: * config_raw:       0x0x2632550
// [INFO]         |         |       0x0x2631fe8: * config_p:         0x0x960
// [INFO]         |         |       0x0x2631ff0: * config_v:         0x0x2632580
// [INFO]         |       0x0x2631c78: transaction_io: 0x0x2632170
// [INFO]         |         |-> 0x0x2632170: header:   0x0
// [INFO]         |         |   0x0x2632178: * input:  0x0x2632190
// [INFO]         |         |   0x0x2632180: * output: 0x0x26321c0
// [INFO] Writing Header:
// [INFO]   0x0: header (0x18 B)
// [INFO] Pushing 0x0x2631c40 onto array
// [INFO] Realloc'ing
// [INFO] Pushing 0x0x2631c60 onto array
// [INFO] Pushing 0x0x2631fd0 onto array
// [INFO] Writing ASIDs:
// [INFO]   0x18: Padding (0x8 B)
// [INFO]   0x20: VAddr 0x0x2631c40 (0x20 B)
// [INFO]   0x40: Padding (0x0 B)
// [INFO]   0x40: VAddr 0x0x2631c60 (0x20 B)
// [INFO] Writing NNIDs:
// [INFO]   0x60: Padding (0x848 B)
// [INFO]   0x3b0: NNID VAddr 0x0x2631fd0 (0x28 B)
// [INFO] Writing NN Configs:
// [INFO]   0x3d8: Padding (0x1416 B)
// [INFO]   0x960: Config (VAddr 0x0x2632580, 0x110 B)
.align 8
antp_os:
.word 0x00000002
.word 0x00000000
.word 0x00000020
.word 0x00000000
.word 0x02631c40
.word 0x00000000
.word 0x00000000
.word 0x00000000
antp_dana:
.word 0x0000000a
.word 0x00000000
.word 0x00000070
.word 0x00000000
.word 0x02631c90
.word 0x00000000
.word 0x02631e30
.word 0x00000000
.word 0x0000000a
.word 0x00000001
.word 0x000003b0 + antp_os
.word 0x00000000
.word 0x02631fd0
.word 0x00000000
.word 0x02632170
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000022
.word 0x00000000
.word 0x00000004
.word 0x00000000
.word 0x02632550
.word 0x00000000
.word data
.word 0x00000000
.word 0x02632580
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000
.word 0x00000000

.align 8
data:
.word 0x000a000f
.word 0x00020009
.word 0x00700010
.word 0x00831000
.word 0x00808020
.word 0x02001060
.word 0x00000000
.word 0x00000000
.word 0x65020070
.word 0x00005bae
.word 0x65020080
.word 0xffffed88
.word 0x65020090
.word 0x000021ca
.word 0x650200a0
.word 0xfffff516
.word 0x650200b0
.word 0x0000639c
.word 0x650200c0
.word 0xffff9cc8
.word 0x650200d0
.word 0x0000671e
.word 0x650200e0
.word 0xffffdab4
.word 0x650800f0
.word 0x000000c6
.word 0x00000000
.word 0x00000000
.word 0xffffa040
.word 0x00005c62
.word 0x00000000
.word 0x00000000
.word 0x0000012e
.word 0x00002a62
.word 0x00000000
.word 0x00000000
.word 0x0000175c
.word 0xffffe8da
.word 0x00000000
.word 0x00000000
.word 0xfffffc36
.word 0x00001fe4
.word 0x00000000
.word 0x00000000
.word 0x0000644a
.word 0x00006294
.word 0x00000000
.word 0x00000000
.word 0xffff9dac
.word 0x00006510
.word 0x00000000
.word 0x00000000
.word 0xffff9aae
.word 0xffff985c
.word 0x00000000
.word 0x00000000
.word 0x00001e52
.word 0xfffff738
.word 0x00000000
.word 0x00000000
.word 0xffff7efc
.word 0xfffffc96
.word 0xffffd8ce
.word 0xffffeaf6
.word 0x00008638
.word 0x00007d92
.word 0x00008466
.word 0x00000582
RVTEST_DATA_END
